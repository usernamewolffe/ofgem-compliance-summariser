{# org_risk_modal.html #}
<section class="h-full flex flex-col">

  <!-- Header -->
  <header class="flex items-start justify-between gap-4 border-b border-gray-200 px-4 py-3">
    <div>
      <p class="text-xs text-gray-500 mb-0.5">
        {{ org.name }}
      </p>
      <h2 class="text-sm font-semibold text-gray-900">
        {{ risk.code or ('R-' ~ (risk.id or 'new')) }}
        &mdash;
        {{ risk.title or 'New risk' }}
      </h2>
    </div>

    <div class="flex gap-2">
      {% if risk.id %}
        <button
          id="riskDrawerDelete"
          type="button"
          data-delete-url="/orgs/{{ org_id }}/org-risks/{{ risk.id }}/delete"
          class="btn small border-red-200 text-red-700 hover:bg-red-50"
        >
          Delete
        </button>
      {% endif %}

      <button
        type="button"
        class="btn small"
        data-risk-drawer-close="1"
      >
        Close
      </button>
    </div>
  </header>

  <!-- Body / form -->
<div class="flex-1 overflow-y-auto px-4 py-3">
  <form
    method="post"
    action="{% if risk.id %}/orgs/{{ org_id }}/org-risks/{{ risk.id }}/update{% else %}/orgs/{{ org_id }}/org-risks/new/save{% endif %}"
    data-risk-form
    class="space-y-4 text-sm"
    onsubmit="return window.handleRiskFormSubmit && window.handleRiskFormSubmit(event, this);"
  >

      <!-- Code -->
      <div>
        <label class="block text-xs font-semibold text-gray-700 mb-1">Risk code</label>
        <input
          type="text"
          name="code"
          value="{{ risk.code or '' }}"
          placeholder="e.g. R-001"
          class="w-full rounded-md border border-gray-300 px-2 py-1.5 text-sm"
        >
        <p class="mt-1 text-xs text-gray-500">
          Must be unique within this organisation. Leave blank to have no code.
        </p>
      </div>

      <!-- Title -->
      <div>
        <label class="block text-xs font-semibold text-gray-700 mb-1">Title</label>
        <input
          type="text"
          name="title"
          value="{{ risk.title or '' }}"
          class="w-full rounded-md border border-gray-300 px-2 py-1.5 text-sm"
          required
        >
      </div>

      <!-- Category -->
      <div>
        <label class="block text-xs font-semibold text-gray-700 mb-1">Category</label>
        <input
          type="text"
          name="category"
          value="{{ risk.category or '' }}"
          class="w-full rounded-md border border-gray-300 px-2 py-1.5 text-sm"
        >
      </div>

      <!-- Status / Severity row -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        <div>
          <label class="block text-xs font-semibold text-gray-700 mb-1">Status</label>
          <select
            name="status"
            class="w-full rounded-md border border-gray-300 px-2 py-1.5 text-sm"
          >
            {% set st = risk.status or 'Open' %}
            <option {% if st == 'Open' %}selected{% endif %}>Open</option>
            <option {% if st == 'In progress' %}selected{% endif %}>In progress</option>
            <option {% if st == 'Mitigated' %}selected{% endif %}>Mitigated</option>
            <option {% if st == 'Closed' %}selected{% endif %}>Closed</option>
          </select>
        </div>

        <div>
          <label class="block text-xs font-semibold text-gray-700 mb-1">Severity</label>
          <select
            name="severity"
            class="w-full rounded-md border border-gray-300 px-2 py-1.5 text-sm"
          >
            {% set sev = risk.severity or '' %}
            <option value="">Not set</option>
            <option value="Low" {% if sev == 'Low' %}selected{% endif %}>Low</option>
            <option value="Medium" {% if sev == 'Medium' %}selected{% endif %}>Medium</option>
            <option value="High" {% if sev == 'High' %}selected{% endif %}>High</option>
            <option value="Severe" {% if sev == 'Severe' %}selected{% endif %}>Severe</option>
          </select>
        </div>
      </div>

      <!-- Owner -->
      <div>
        <label class="block text-xs font-semibold text-gray-700 mb-1">Owner</label>
        <select
          name="owner_id"
          class="w-full rounded-md border border-gray-300 px-2 py-1.5 text-sm"
        >
          <option value="">Unassigned</option>
          {% for m in members %}
            <option
              value="{{ m.id }}"
              {% if risk.owner_id and risk.owner_id == m.id %}selected{% endif %}
            >
              {{ m.name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- Description -->
      <div>
        <label class="block text-xs font-semibold text-gray-700 mb-1">Description</label>
        <textarea
          name="description"
          rows="4"
          class="w-full rounded-md border border-gray-300 px-2 py-1.5 text-sm"
        >{{ risk.description or '' }}</textarea>
      </div>

      <!-- Buttons -->
      <div class="pt-2 flex justify-end gap-2">
        <button type="button" class="btn small" data-risk-drawer-close="1">
          Cancel
        </button>
        <button type="submit" class="btn small primary">
          Save risk
        </button>
      </div>
    </form>
  </div>
</section>
