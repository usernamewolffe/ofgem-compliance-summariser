{% extends "base.html" %}
{% block title %}{{ org.name }} — Overview{% endblock %}

{% block content %}
<div class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 py-6 grid gap-6 lg:grid-cols-[320px_1fr]">

  <!-- Sidebar: Head office -->
  <aside class="rounded-xl border border-gray-100 bg-white p-5 shadow-sm">
    <nav class="text-xs text-gray-500 mb-3">
      <a href="/summaries?org_id={{ org_id }}" class="hover:underline text-emerald-700">Summaries</a>
      <span class="mx-1">/</span>
      <span>{{ org.name }}</span>
    </nav>

    <h2 class="text-lg font-semibold text-gray-900">{{ org.name }}</h2>
    <p class="text-sm text-gray-500 mt-1">Head office</p>

    <dl class="mt-3 space-y-2 text-sm">
      {% if org.head_office_address %}
      <div>
        <dt class="text-gray-400">Address</dt>
        <dd>{{ org.head_office_address }}</dd>
      </div>
      {% endif %}
      {% if org.phone %}
      <div>
        <dt class="text-gray-400">Phone</dt>
        <dd>{{ org.phone }}</dd>
      </div>
      {% endif %}
      {% if org.email %}
      <div>
        <dt class="text-gray-400">Email</dt>
        <dd><a href="mailto:{{ org.email }}" class="text-emerald-700 hover:underline">{{ org.email }}</a></dd>
      </div>
      {% endif %}
      {% if org.website %}
      <div>
        <dt class="text-gray-400">Website</dt>
        <dd><a href="{{ org.website }}" target="_blank" rel="noopener" class="text-emerald-700 hover:underline">{{ org.website }}</a></dd>
      </div>
      {% endif %}
    </dl>

    <!-- Org-wide quick links -->
    <div class="mt-5 space-y-2">
      <a href="/orgs/{{ org_id }}/org-controls"
         class="block w-full text-center px-3 py-2 text-sm font-medium rounded-lg border border-emerald-200 text-emerald-700 hover:bg-emerald-50 transition">
        Controls <span class="text-gray-400">({{ counts.org_controls }})</span>
      </a>
      <a href="/orgs/{{ org_id }}/org-risks"
         class="block w-full text-center px-3 py-2 text-sm font-medium rounded-lg border border-rose-200 text-rose-700 hover:bg-rose-50 transition">
        Risks <span class="text-gray-400">({{ counts.org_risks }})</span>
      </a>
    </div>
    <p class="text-xs text-gray-500 mt-2 leading-relaxed">
      Sites add <span class="font-medium">{{ counts.site_controls }}</span> controls and
      <span class="font-medium">{{ counts.site_risks }}</span> risks.
    </p>
  </aside>

  <!-- Main -->
  <main class="space-y-6">

    <!-- Key personnel -->
    <section class="rounded-xl border border-gray-100 bg-white p-5 shadow-sm">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-base font-semibold text-gray-900">Key personnel</h3>
        <a class="px-3 py-1.5 text-sm rounded-md border border-emerald-200 text-emerald-700 hover:bg-emerald-50 transition"
           href="/orgs/{{ org_id }}/members">
          Manage
        </a>
      </div>

      {% if key_people and key_people|length %}
        <ul class="grid gap-3">
          {% if uro %}
          <li class="p-3 rounded-lg border border-emerald-200 bg-emerald-50/50">
            <div class="text-sm">
              <span class="font-medium">{{ uro.name }}</span>
              <span class="text-gray-500"> — {{ uro.role or 'Ultimate risk owner' }}</span>
              {% if uro.email %} ·
                <a href="mailto:{{ uro.email }}" class="text-emerald-700 hover:underline">{{ uro.email }}</a>
              {% endif %}
            </div>
            <div class="text-xs text-emerald-700 mt-1">Person with ultimate responsibility for risk management</div>
          </li>
          {% endif %}

          {% for p in key_people %}
            {% if not (uro and p.id == uro.id) %}
            <li class="p-3 rounded-lg border border-gray-200">
              <div class="text-sm">
                <span class="font-medium">{{ p.name }}</span>
                {% if p.role %}<span class="text-gray-500"> — {{ p.role }}</span>{% endif %}
                {% if p.email %} ·
                  <a href="mailto:{{ p.email }}" class="text-emerald-700 hover:underline">{{ p.email }}</a>
                {% endif %}
              </div>
            </li>
            {% endif %}
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-sm text-gray-500 mt-2">No key personnel recorded yet.</p>
      {% endif %}
    </section>

    <!-- Sites -->
    <section class="rounded-xl border border-gray-100 bg-white p-5 shadow-sm">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-base font-semibold text-gray-900">Sites</h3>
        <div class="flex gap-2">
          <a class="px-3 py-1.5 text-sm rounded-md border border-gray-200 text-gray-700 hover:bg-gray-50 transition"
             href="/orgs/{{ org_id }}/sites">View all</a>
          <a class="px-3 py-1.5 text-sm rounded-md border border-emerald-200 text-emerald-700 hover:bg-emerald-50 transition"
             href="/orgs/{{ org_id }}/sites/new">+ Add site</a>
        </div>
      </div>

      {% if sites and sites|length %}
        <ul class="grid gap-3">
          {% for s in sites %}
          <li class="p-4 rounded-xl border border-gray-200 hover:border-emerald-300 transition">
            <div class="flex items-start justify-between">
              <div>
                <div class="text-sm font-semibold text-gray-900">{{ s.name }}</div>
                <div class="text-xs text-gray-500 mt-0.5">
                  {% if s.address %}{{ s.address }}{% endif %}
                  {% if s.phone %} · {{ s.phone }}{% endif %}
                  {% if s.email %} ·
                    <a class="text-emerald-700 hover:underline" href="mailto:{{ s.email }}">{{ s.email }}</a>
                  {% endif %}
                </div>
              </div>
              <div class="flex flex-wrap gap-2">
                <a class="px-3 py-1.5 text-sm border rounded-md hover:bg-gray-50"
                   href="/orgs/{{ org_id }}/sites/{{ s.id }}/edit">View / Edit</a>
                <a class="px-3 py-1.5 text-sm border rounded-md hover:bg-gray-50"
                   href="/orgs/{{ org_id }}/sites/{{ s.id }}/controls">Controls</a>
                <a class="px-3 py-1.5 text-sm border rounded-md hover:bg-gray-50"
                   href="/orgs/{{ org_id }}/sites/{{ s.id }}/risks">Risks</a>
              </div>
            </div>
          </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-sm text-gray-500 mt-2">No sites recorded yet.</p>
      {% endif %}
    </section>

  </main>
</div>
{% endblock %}
