{% extends "base.html" %}
{% block title %}Site risks{% endblock %}

{% block content %}
  <div class="page-title">
    <div>
      <a href="/orgs/{{ org.id if org is defined else org_id }}"
         class="text-sm text-emerald-700 hover:text-emerald-900">
        ← Back to organisation
      </a>
      <h1>
        {% if site is defined and site.name %}
          {{ site.name }} — Risks
        {% else %}
          Site risks
        {% endif %}
      </h1>
      <p class="text-sm text-slate-600">
        Risks that are currently linked to this site.
      </p>
    </div>
  </div>

  <div class="wrap">
    <section class="panel w-full max-w-4xl">
      <header class="flex items-center justify-between mb-4 gap-4">
        <div>
          <h2 class="text-base font-semibold text-slate-900">
            {% if site is defined and site.name %}
              {{ site.name }}
            {% else %}
              Site
            {% endif %}
          </h2>
          {% if org is defined and org.name %}
            <p class="text-xs text-slate-500">
              Organisation: {{ org.name }}
            </p>
          {% endif %}
        </div>

        <span class="pill">
          {{ (risks or site_risks or [])|length }} risks
        </span>
      </header>

      {% set rows = risks or site_risks or [] %}

      {% if rows and rows|length %}
        <ul class="space-y-3">
          {% for r in rows %}
            <li class="flex items-start justify-between gap-4 rounded-xl border border-slate-200 bg-white px-4 py-3">
              <div class="min-w-0">
                <div class="text-sm font-semibold text-slate-900">
                  {{ r.code or ('R-' ~ r.id) }}
                  {% if r.title %}
                    <span class="ml-2 font-normal text-slate-800">
                      {{ r.title }}
                    </span>
                  {% endif %}
                </div>

                {% if r.description %}
                  <p class="mt-1 text-sm text-slate-600 line-clamp-3">
                    {{ r.description }}
                  </p>
                {% endif %}

                <div class="mt-2 flex flex-wrap gap-2 text-xs text-slate-500">
                  {% if r.status %}
                    <span class="px-2 py-0.5 rounded-full border border-emerald-100 bg-emerald-50 text-emerald-700">
                      {{ r.status }}
                    </span>
                  {% endif %}
                  {% if r.owner_name %}
                    <span class="px-2 py-0.5 rounded-full border border-slate-200 bg-slate-50">
                      Owner: {{ r.owner_name }}
                    </span>
                  {% endif %}
                </div>
              </div>

              <a href="/orgs/{{ org.id if org is defined else org_id }}/org-risks/{{ r.id }}"
                 class="btn small">
                View
              </a>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="rounded-xl border border-dashed border-slate-200 bg-slate-50 px-4 py-6 text-center text-sm text-slate-500">
          No risks are currently linked to this site.
        </div>
      {% endif %}
    </section>
  </div>
{% endblock %}
